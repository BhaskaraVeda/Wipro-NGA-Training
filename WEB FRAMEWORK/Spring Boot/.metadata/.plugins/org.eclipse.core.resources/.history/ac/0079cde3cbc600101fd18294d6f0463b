package com.example.taskmanager.controller;

import com.example.taskmanager.model.Task;
import com.example.taskmanager.service.TaskService;
import org.springframework.web.bind.annotation.*;
import jakarta.validation.Valid;
import org.springframework.http.*;

import java.util.*;

@RestController
@RequestMapping("/task")
public class TaskController {

	 private final TaskService service;
	 
	 public TaskController(TaskService s){
		 this.service=s;
	  }
	 
	
	 @PostMapping
	 public ResponseEntity<?> add(@Valid @RequestBody Task t){
		 
	  return ResponseEntity.status(HttpStatus.CREATED).body(service.addTask(t));
	  
	 }
	
	 @PutMapping
	 public ResponseEntity<?> update(@Valid @RequestBody Task t){
		 
	  return ResponseEntity.ok(service.updateTask(t));
	  
	 }
	
	 @DeleteMapping("/{id}")
	 public ResponseEntity<?> delete(@PathVariable Integer id){
		 
	  service.deleteTask(id);
	  return ResponseEntity.ok("Task deleted");
	  
	 }
	
	 @GetMapping
	 public List<Task> getAll(){ 
		 
		 return service.getAll(); 
	 }
	
	 @GetMapping("/search")
	 public ResponseEntity<?> search(@RequestParam(required=false) String status){
		 
	  if(status==null||status.isBlank())
	    return ResponseEntity.status(400).body("status query parameter required");
	  
	  return ResponseEntity.ok(service.searchByStatus(status));
	  
	 }
	
	 @GetMapping("/priority/{p}")
	 public List<Task> byPriority(@PathVariable String p){
		 
	  return service.byPriority(p);
	  
	 }
	
	 @GetMapping("/overdue")
	 public List<Task> overdue(){
		 
		 return service.overdue(); 
		 
	 }
}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <h2>optimized Dashboard</h2>
    <h1>Cache Selectors, single DOM Update,
        documnet fragment, promisa.all, async, await</h1>
    <p>We can see the difference on conlsole via logs</p>

    <ul id="userList"></ul>
    <script>
        async function loadDashboard() {

            const timestart = performance.now();

            //fetching the data concurrently (Promise.all)
            const [users, posts] = await Promise.all([

                fetch("https://jsonplaceholder.typicode.com/users").then(r => r.json()),
                fetch("https://jsonplaceholder.typicode.com/posts").then(r => r.json())
            ])

            //Use a documentFragment to batch DOM update(single append child we'll be keeping)
            const fragment = document.createDocumentFragment();

            // Here, we've to build/keep the elements in the memory, so we use cached se;ector only at the final append
            users.slice(0, 50).forEach(u => {

                const li = document.createElement("li");
                li.textContent = `${u.name} - ${u.email}`;
                fragment.appendChild(li); //appends to a fragment
            });

            //Single DOM manipulation using cache selector
            userList.appendChild(fragment); 

            const timestop = performance.now();

            console.log("Total time taken:", Math.round(timestop - timestart));
            console.log("users: ", users.length, "Posts: ", posts.length);
        }

        loadDashboard();

    </script>
</body>

</html>